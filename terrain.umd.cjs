(function(o,t){typeof exports=="object"&&typeof module<"u"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(o=typeof globalThis<"u"?globalThis:o||self,t(o.terrain={}))})(this,function(o){"use strict";var w=Object.defineProperty;var b=(o,t,i)=>t in o?w(o,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):o[t]=i;var u=(o,t,i)=>(b(o,typeof t!="symbol"?t+"":t,i),i);const t=async(d,e)=>{let r;try{r=await fetch(d,{signal:e})}catch(n){return e.aborted||console.error(`Failed to fetch image: ${n}`),null}return r.ok?await createImageBitmap(await r.blob()):null};class i{constructor(e){u(this,"worker");u(this,"pendingRequests");u(this,"handleMessage",e=>{const{url:r,buffer:n,error:a}=e.data;if(a)console.error(`Error processing tile ${r}:`,a);else{const s=this.pendingRequests.get(r);s&&(s.resolve({data:new Uint8Array(n)}),this.pendingRequests.delete(r))}});u(this,"handleError",e=>{console.error("Worker error:",e),this.pendingRequests.forEach(r=>{r.reject(new Error("Worker error occurred"))}),this.pendingRequests.clear()});this.worker=e,this.pendingRequests=new Map,this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)}async request(e,r){const n=await t(e,r.signal);return n?new Promise((a,s)=>{this.pendingRequests.set(e,{resolve:a,reject:s,controller:r}),this.worker.postMessage({image:n,url:e}),r.signal.onabort=()=>{this.pendingRequests.delete(e),s(new Error("Request aborted"))}}):Promise.reject(new Error("Failed to load image"))}}const l=new Worker(new URL(""+(typeof document>"u"&&typeof location>"u"?new(require("url")).URL("file:"+__dirname+"/assets/worker.2eeb969e.js").href:new URL("assets/worker.2eeb969e.js",typeof document>"u"?location.href:document.currentScript&&document.currentScript.src||document.baseURI).href),self.location),{type:"module"}),m=new i(l),f=(d,e={})=>{var n,a,s,c;return d("gsidem",(p,h)=>{const g=p.url.replace("gsidem://","");return m.request(g,h)}),{type:"raster-dem",tiles:[`gsidem://${(n=e.tileUrl)!=null?n:"https://cyberjapandata.gsi.go.jp/xyz/dem_png/{z}/{x}/{y}.png"}`],tileSize:256,minzoom:(a=e.minzoom)!=null?a:1,maxzoom:(s=e.maxzoom)!=null?s:14,attribution:(c=e.attribution)!=null?c:'<a href="https://maps.gsi.go.jp/development/ichiran.html">\u5730\u7406\u9662\u30BF\u30A4\u30EB</a>'}};o.useGsiTerrainSource=f,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
